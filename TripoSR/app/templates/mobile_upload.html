<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Images - 2D Image to 3D</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .upload-area { 
            border: 2px dashed #ccc; 
            border-radius: 10px; 
            padding: 20px; 
            text-align: center;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        .preview-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .preview-image { width: 100%; height: 100px; object-fit: cover; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="max-w-md mx-auto p-4">
        <div class="bg-white/20 backdrop-blur-lg rounded-xl p-6 text-white">
            <h1 class="text-2xl font-bold mb-4 text-center">Upload Images for 3D Generation</h1>
            
            <div class="upload-area" id="upload-area">
                <svg class="mx-auto h-12 w-12 text-white/70 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p class="text-white mb-4">Select up to 4 images</p>
                <input type="file" id="file-input" multiple accept="image/*" class="hidden">
                <button onclick="document.getElementById('file-input').click()" class="bg-blue-500 text-white px-6 py-2 rounded-lg">
                    Choose Images
                </button>
            </div>
            
            <div id="preview-container" class="hidden">
                <p class="text-white mt-4 mb-2">Selected Images:</p>
                <div id="preview-grid" class="preview-grid"></div>
            </div>
            
            <button id="upload-btn" class="w-full bg-green-500 text-white py-3 rounded-lg mt-4 disabled:opacity-50" disabled>
                Upload Images
            </button>
            
            <div id="success-message" class="hidden bg-green-500 text-white p-4 rounded-lg mt-4 text-center">
                Images uploaded successfully! You can now close this page.
            </div>
        </div>
    </div>

    <script>
        const sessionId = '{{ session_id }}';
        const fileInput = document.getElementById('file-input');
        const previewContainer = document.getElementById('preview-container');
        const previewGrid = document.getElementById('preview-grid');
        const uploadBtn = document.getElementById('upload-btn');
        const successMessage = document.getElementById('success-message');
        
        let selectedFiles = [];

        fileInput.addEventListener('change', function(e) {
            selectedFiles = Array.from(e.target.files).slice(0, 4);
            displayPreviews();
            uploadBtn.disabled = selectedFiles.length === 0;
        });

        function displayPreviews() {
            previewGrid.innerHTML = '';
            previewContainer.classList.remove('hidden');
            
            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'preview-image';
                    previewGrid.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        uploadBtn.addEventListener('click', async function() {
            const formData = new FormData();
            selectedFiles.forEach(file => formData.append('images', file));
            
            try {
                uploadBtn.disabled = true;
                uploadBtn.textContent = 'Uploading...';
                
                const response = await fetch(`/api/mobile-upload/${sessionId}`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    successMessage.classList.remove('hidden');
                    previewContainer.classList.add('hidden');
                    uploadBtn.classList.add('hidden');
                } else {
                    alert('Upload failed: ' + result.error);
                }
            } catch (error) {
                alert('Upload failed: ' + error.message);
            }
        });
    </script>
</body>
</html>
